<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{layout/fragments :: head}">
</head>

<body class="container-fluid d-flex flex-column vh-100 p-0 m-0"></body>
<!-- Cabecera -->
<header th:replace="~{layout/fragments :: header}">
</header>

<!-- Estructura principal del cuerpo de la página -->
<div class="flex-grow-1 d-flex">

    <aside th:replace="~{layout/fragments :: aside}">
    </aside>


    <main class="col-md-9 col-12 p-3">

        <div class="alert alert-success" th:if="${success}" th:text="${success}"></div>
        <div class="alert alert-danger" th:if="${error}" th:text="${error}"></div>

            <div class="mb-5">
                <h2>Estadísticas y control de <span sec:authentication="name"></span></h2>
            </div>
            
            <div th:if="${!userRecords.isEmpty()}">
                <nav th:replace="~{layout/paginator-nav :: nav}"></nav>
            </div>

            <div class="table-responsive">
                <table class="table table-sm table-bordered table-hover">

                    <thead class="table-primary">
                        <tr>
                            <th>Fecha</th>
                            <th>Altura</th>
                            <th>Peso</th>
                            <th style="width: 5%;"></th>
                        </tr>
                    </thead>
                    
                    <tbody class="text-secondary info-txt ">

                        <tr class="p-1" th:if="${userRecords.isEmpty()}">
                            <td colspan="4">
                                <span>No hay registros aun</span>
                            </td>
                        </tr>

                        <tr th:if="${!userRecords.isEmpty()}" th:each="userRecord, iterStat : ${userRecords}">
                            <form th:id="'updateUserRecordForm_'+${iterStat.index}" th:action="@{/app/user_record/update}" th:method="PUT">
                                <td>
                                    <input type="hidden" name="id" th:value="${userRecord.id}">
                                    <input type="date" name="date" class="border-0" th:value="${userRecord.date}">
                                </td>
                                <td>
                                    <input type="number" name="height" class="border-0 w-set-input" th:value="${userRecord.height}">
                                    <span class="ms-1">cm</span>
                                </td>
                                <td>
                                    <input type="number" name="weight" class="border-0 w-set-input" th:value="${userRecord.weight}">
                                    <span class="ms-1">kg</span>
                                </td>
                            </form>

                            <td>
                                <div class="d-flex">
                                    <form th:action="@{/app/user_record/delete/} + ${userRecord.id}" th:method="DELETE">
                                        <button class="me-1 table-mini-btn" onclick="return confirm('¿Estás seguro que deseas eliminar este registro?')"
                                            type="submit">
                                            <i class="fa-solid fa-trash"></i>
                                        </button>
                                    </form>
                                    <button th:form="'updateUserRecordForm_'+${iterStat.index}" class="me-1 table-mini-btn" type="submit">
                                            <i class="fa-solid fa-floppy-disk"></i>
                                    </button>
                                </div>
                            </td>
                            
                        </tr>
                    </tbody>
                    
                    <tbody class="mt-1 info-txt table-secondary">
                        <tr><td></td><td colspan="3"><div class="ms-1">Última vez</div></td></tr>
                        <tr>
                            <form id="createUserRecordForm" th:object="${userRecord}" th:action="@{/app/user_record/create}" method="POST">
                                <td>
                                    <input type="date" class="border-0" th:field="*{date}">
                                </td>
                                <td>
                                    <input type="number" class="border-0 w-set-input" th:field="*{height}">
                                    <span class="ms-1">cm</span>
                                </td>
                                <td colspan="2">
                                    <input type="number" class="border-0 w-set-input" step="0.1" th:field="*{weight}">
                                    <span class="ms-1" >kg</span>
                                </td>
                            </form>
                        </tr>
                    </tbody>
                </table>
                <button form="createUserRecordForm" class="me-1 btn btn-sm btn-success" type="submit">
                    Añadir nuevo registro<i class="ms-2 fa-solid fa-plus"></i>
                </button>
            </div>


    </main>

</div>

<!-- Pie de página -->
<footer th:replace="~{layout/fragments :: footer}">

</footer>

</body>

</html>